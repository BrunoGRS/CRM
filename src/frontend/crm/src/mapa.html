<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CoffeeCRM - Mapa</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
    <link rel="stylesheet" href="./assets/style.css">
</head>
<body>
<div id="sidebar-container"></div>

<div class="content">
    <div class="topbar">
        <h3 class="titulo">Mapa de Equipamentos</h3>
        <div class="search-bar">
            <input type="text" id="searchInput" class="form-control" placeholder="Buscar equipamento...">
            <button class="btn btn-dark" onclick="searchEquipamento()">Buscar</button>
        </div>
    </div>
    <div id="map"></div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
fetch('./assets/sidebar.html')
.then(response => response.text())
.then(data => {
document.getElementById('sidebar-container').innerHTML = data;

const currentPage = window.location.pathname.split("/").pop();
document.querySelectorAll('.sidebar .nav-link').forEach(link => {
    const linkPage = link.getAttribute('href');
    if (linkPage === currentPage) link.classList.add('active');
});
})
.catch(error => console.error('Erro ao carregar sidebar:', error));

var map = L.map('map').setView([-27.333, -50.333], 8);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '© BrasitaliaCRM'
}).addTo(map);

var equipamentos = [
    { nome: "IBRAFLEX IN", lat: -27.096, lng: -52.615 },
    { nome: "OESTE CENT", lat: -27.1, lng: -52.62 },
    { nome: "Vidas Corridas", lat: -27.09, lng: -52.61 },
    { nome: "Expresso 330", lat: -27.095, lng: -52.618 },
    { nome: "AgroVale Chapecó", lat: -27.104, lng: -52.631 },
    { nome: "TechSul Informática", lat: -28.482, lng: -49.006 },
    { nome: "Madeireira São Domingos", lat: -26.56, lng: -52.53 },
    { nome: "CooperLitoral", lat: -28.238, lng: -48.672 },
    { nome: "Auto Center Xanxerê", lat: -26.876, lng: -52.407 },
    { nome: "Hotel Atlântico Sul", lat: -28.707, lng: -49.363 },
    { nome: "Transportes Noroeste", lat: -26.725, lng: -52.984 },
    { nome: "Frigorífico Santa Fé", lat: -27.272, lng: -52.77 },
    { nome: "Clínica Vida & Saúde", lat: -27.601, lng: -52.284 },
    { nome: "Pescados Laguna Mar", lat: -28.483, lng: -48.780 }
];

equipamentos.forEach(eq => {
    L.marker([eq.lat, eq.lng]).addTo(map).bindPopup(eq.nome);
});

function searchEquipamento() {
    const query = document.getElementById("searchInput").value.toLowerCase();
    const equipamento = equipamentos.find(eq => eq.nome.toLowerCase().includes(query));

    if (equipamento) {
        map.setView([equipamento.lat, equipamento.lng], 15);
        L.popup()
        .setLatLng([equipamento.lat, equipamento.lng])
        .setContent(`<b>${equipamento.nome}</b>`)
        .openOn(map);
    } else {
        alert("Equipamento não encontrado.");
    }
}
</script>

</body>
</html>
